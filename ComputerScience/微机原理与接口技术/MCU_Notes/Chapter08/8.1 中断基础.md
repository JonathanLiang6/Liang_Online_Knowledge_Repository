### 8.1.1 中断的基本概念
- **中断**：CPU正常运行时，由于内、外部事件或程序预先安排，暂停当前程序转去执行事件服务程序，处理完毕后返回原程序继续执行的过程。
- **中断源**：产生中断请求的外设或引发内部中断的原因和事件。
- **中断请求**：中断源为获得CPU处理而向CPU发出的请求信号。
- **中断响应**：CPU接到中断请求信号后，若决定响应则向外设发出中断响应信号的过程。
- **中断屏蔽**：禁止中断响应。
- **主程序**：CPU接收到中断请求时当前执行的程序。
- **断点**：CPU处理中断时，原程序的暂时中止处（即中断返回后继续执行的指令地址）。
- **中断服务程序**：中断源发出中断请求后请求CPU执行的处理程序。
- **入口地址**：中断服务程序首条指令的地址。
- **中断处理**：CPU执行中断服务程序的过程。
- **中断返回**：CPU执行完中断服务程序后，返回原程序断点处继续执行后续程序的过程。
![[../../MCU_Picture/Pasted image 20250525153203.png]]

### 8.1.2 中断优先级与中断嵌套
**注意**：CPU 某一时刻只能响应**一个**中断请求。
微机系统中存在多个中断源，往往会出现以下情况： 
（1）多个中断源在同一时间向 CPU 发出中断请求信号； 
（2）当 CPU 正在响应某一中断源的请求，执行相应中断服务程序时，又有别的中断源产生新的中断请求。
#### 8.1.2.1 优先级：CPU依据各中断源任务的轻重缓急，将中断源分成若干级别。
**处理原则**：
- 多个同时请求时，响应优先级最高的中断。
- 处理中断时，能响应更高优先级中断，屏蔽同级或低级中断，即**多重中断**或**中断嵌套**。
#### 8.1.2.2 **解决优先级的方法**：
  **1.软件查询方式**：
- 各中断源请求信号锁存于中断状态端口（锁存器），相应位置1。
- 所有中断请求信号相“或”后作为INTR信号向CPU请求。
- CPU响应后通过公共查询程序确定中断源并转入对应服务程序，查询顺序即优先级顺序。
![[../../MCU_Picture/Pasted image 20250525153523.png]]
- 优点：硬件简单，可通过修改查询顺序改变优先级。
- 缺点：中断源较多时耗时较长，影响实时性。
**2.硬件排队方式**：利用专门的硬件电路实现中断源优先级排队
**链式优先级排队**：
每个中断源接口设菊花链逻辑电路，利用**物理位置**确定优先级
**特点**：调整优先级需改动硬件，使用不便
![[../../MCU_Picture/Pasted image 20250525153702.png]]
**向量优先级排队**：
用**专门优先级中断控制**器构成向量优先级中断系统管理优先级，用户可通过编程调整，无需改动硬件接口
![[../../MCU_Picture/Pasted image 20250525153747.png]]
### 8.1.3 中断过程
中断过程包括中断请求、中断响应、中断处理和中断返回四个阶段。
#### 8.1.3.1 **中断请求**
**条件 1**：中断源需CPU服务且已准备就绪；
**条件 2**：系统允许该中断源申请（多中断源时，外设接口常设中断屏蔽寄存器，未被屏蔽的中断请求才能送到CPU）
以上两个条件需**同时**满足。
#### 8.1.3.2 **中断响应**
CPU检测到中断请求，有权决定是否响应，若允许则进入中断响应周期。
CPU 响应中断时自动完成任务：
- 1.关中断：防止响应中断期间被其他中断打扰。
- 2.断点保护：通过内部硬件保存**断点**及**标志寄存器**内容，以便中断处理完毕后正确返回。
- 3.获得中断服务程序入口地址：CPU响应后以某种方式**查找**中断源获得入口地址，转向对应的中断服务程序
以上前两步由硬件完成，最后一步可由硬件或软件实现。
#### 8.1.3.3 **中断处理**
由中断服务程序完成，一般包括以下工作：
1.**保护现场**：
将断点处各寄存器内容压入堆栈保护，防止被中断处理程序破坏。
2.**开中断**：
中断响应阶段硬件自动执行**关中断**，保护 CPU 在中断响应时不会被再次中断。有时需**开中断**以允许中断嵌套（更紧急的情况）
处理关键部分时可再关中断：中断过程中，可以多次开放和关闭中断，一般只在程序的关键部分才关闭中断，其它部分则要开放中断以允许中断嵌套。
- **中断服务**：根据中断源功能执行相应服务，是中断处理的主体部分，需事先编写程序存入内存。
- **关中断**：若执行了开中断，需关中断为恢复现场做准备。
- **恢复现场**：中断服务完毕后，按先进后出原则从堆栈弹出保护的寄存器内容，确保返回主程序后正确运行。
#### 8.1.3.4 **中断返回**
中断服务程序最后一条指令为中断返回指令IRET，执行该指令使CPU回到被中断的程序继续执行，图8.6为中断过程示意图。
### [[../../MCU_Contents/第8章 中断技术|回到目录]]