### 3.4.1 介质访问控制
**介质访问控制** (Medium Access Control，MAC): 多个节点共享同一个**总线型**广播信道时，可能发生“信号冲突”
**三种方法**：
- 信道划分
- 随机访问
- 轮询访问
### 3.4.2 信道划分

#### 3.4.2.1 时分复用（TDM）
- 将时间划分为大小固定的时间片，各节点依次轮流占用一个时间片。
- **缺点**：
	- 每个节点最多只能分配到信道总带宽的 $\frac{1}{m}$ 
	- 如果某节点暂不发送数据，会导致被分配的“时隙”闲置，信道利用率低
- 为解决上述缺点，形成了统计时分复用
#### 3.4.2.2 统计时分复用（STDM）
- 在 TDM 基础上按需分配时间片，避免空闲时隙浪费。
- **优点**：
	- 如果需要时，一个节点可以在一段时间内获得**所有的**信道带宽资源
	- 如果某节点暂不发送数据，可以不分配“时隙”，信道利用率更高
#### 3.4.2.3 频分复用（FDM）
- 把总频带划分为多条**互不重叠**的子频带，每个发送节点固定占用一条子频带。
- **优缺点解析**：
	- 优点: 各节点可同时发送信号; 充分利用了信道带宽  
	- 缺点: FDM 技术只能用于模拟信号的传输
#### 3.4.2.4 波分复用（WDM）
- 用于**光纤**，本质上是光的频分复用
- 利用不同波长（即不同频率）承载多路光信号
#### 3.4.2.5 码分复用（CDM）
1. 码片序列  
   - 包含 m 个码片（信号值），可看作 m 维向量，分量通常取 1 或 -1。  
   - 要求：各节点的 m 维向量必须相互正交（两两内积为 0）。  
   - 相互通信的节点彼此知道对方的码片序列。
2. 发送规则  
   - 节点发出与码片序列相同的 m 个信号值，表示比特 1。  
   - 节点发出与码片序列相反的 m 个信号值，表示比特 0。
3. 信号叠加  
   - 多节点同时发送时，信号值线性叠加（即多个 m 维向量相加）。
4. 接收分离  
   - 接收方将收到的叠加信号与目标发送方的码片序列做规格化内积：  
     - 结果为 1，表示该发送方传了比特 1；  
     - 结果为 -1，表示该发送方传了比特 0。
### 3.4.3 随机访问

#### 3.4.3.1 ALOHA 协议
![[../../CN_Picture/Pasted image 20251126140221.png]]
##### 纯 ALOHA
- 节点一旦准备好数据帧，就立即发送到信道上。  
- 若超时未收到 ACK，随机等待一段时间后重传。
##### 时隙 ALOHA
- 把信道时间划分为固定长度的“时隙”，时隙大小 = 传输一个最长帧所需时间。 
- 各节点只能在时隙起始时刻发送帧，冲突概率比纯 ALOHA 显著降低。
#### 3.4.3.2 CSMA 协议
**CSMA**（载波监听多路访问协议）：发送数据前先监听信道，空闲时才尝试发送

| 协议        | 信道空闲动作                  | 信道忙动作           | 特点记忆                |
| --------- | ----------------------- | --------------- | ------------------- |
| 1-坚持 CSMA | 立即发送（概率 1）              | 坚持持续监听，直到空闲立即发送 | “1”= 空闲必发，忙时“坚持”监听  |
| 非坚持 CSMA  | 立即发送（概率 1）              | 随机推迟一段时间后再次监听   | “非坚持”= 忙时不监听，退避再试   |
| p-坚持 CSMA | 以概率 p 立即发送，以概率 1-p 推迟发送 | 持续监听信道（坚持）      | “p”= 空闲时概率发送，忙时持续监听 |
![[../../CN_Picture/Pasted image 20251126212111.png]]
![[../../CN_Picture/Pasted image 20251126212126.png]]
![[../../CN_Picture/Pasted image 20251126212133.png]]
#### 3.4.3.3 CSMA/CD 协议
监听+冲突检测；1-坚持的 plus 版本
##### 协议要点
先听后发，边听边发，冲突停发，随机重发。
**截断二进制指数退避算法（如何随机重发）**  
- 随机等待时间 = r × 争用期，r 按以下规则取值：  
	- 若冲突次数 k ≤ 10，在 $[0, 2^k − 1]$ 内随机取整数 r；  
	- 若 k > 10，仍在 $[0, 2^{10} − 1]$ 内随机取整数 r
- **注意**：
	- 第 10 次冲突为“随机重发”分水岭  
	- 第 16 次冲突仍不成功则放弃传输，向上级（网络层）报告错误。
![[../../CN_Picture/Pasted image 20251202224925.png]]
**2. 争用期**  
- **定义**：争用期 = 2 × 最大单向传播时延（考虑距离最远的两个节点）。  
- **作用**：若发送方在争用期内未检测到冲突，则该帧后续不会再发生冲突。
**3. 无 ACK 机制**  
- CSMA/CD 不等待 ACK；发送过程中若未检测到冲突，即认为帧发送成功。
**4. 帧长限制**  
- 最短帧长 = 2 × 最大单向传播时延 × 信道带宽；  
  - 以太网规定：最短帧长 = 64 B；帧小于此值视为无效帧。  
- 最长帧长：规定上限可防止某节点长期独占信道；  
  - 以太网规定：最长帧长 = 1518 B。
#### 3.4.3.4 CSMA/CA 协议
用于无线网络通信
##### 发送接收
**发送方：先听后发，忙则退避**
- 若信道空闲，间隔 DIFS 后，再发送帧（一口气发完，发送过程中不用检测冲突）。  
- 若信道不空闲，则进行“**随机退避**”：  
  ① 用二进制指数退避算法确定一段随机退避时间（倒计时）。  
  ② 发送方会保持监听信道，只有信道空闲时才“扣除倒计时”；倒计时结束后立即发送帧（此时信道“听起来”一定空闲）。
**接收方：停止等待协议**
- 每收到一个正确数据帧都返回 ACK；若发送方超时未收到 ACK，则进行“随机退避”后重传。
##### 信道预约机制（可选功能）用于解决隐藏站问题
![[../../CN_Picture/Pasted image 20251204235946.png]]
- 发送方广播 RTS 控制帧（先听后发，忙则退避） 
- AP 广播 CTS 控制帧。  
	- 上两步需在 RTS、CTS 中指明预约时长。 
- 其他无关节点收到 CTS 后自觉“禁言”一段时间（即虚拟载波监听机制）；发送方收到 CTS 后，就可以发送数据帧。  
- AP 收到数据帧后，进行 CRC 校验，若无差错就返回 ACK 帧。
##### 帧间间隔 IFS
- DIFS：最长的 IFS，每次“帧事务”开始之前需要等待的时间。  
- SIFS：最短的 IFS，收到一个帧后需要预留的一段处理时间。  
- PIFS：中等长度的 IFS（考研可不关注）。  
![[../../CN_Picture/Pasted image 20251204235802.png]]
### 3.4.4 轮询访问：令牌传递协议
#### 3.4.4.1 令牌帧与数据帧
- **令牌帧**
	- **需指明**当前获得令牌的节点编号。  
	- 只有获得令牌（Token）的节点才能往信道上发送数据帧。  
	- 如果获得令牌的节点没有数据要发送，就将令牌传递下一个节点。
- **数据帧**
	- **需指明**数据帧的源地址 / 目的地址、是否已被接收、获得令牌的节点编号。
	- - 数据帧从源节点发出，“传递一圈”后回到源节点。  
	- 数据帧“传递一圈”的过程中，会被**目的节点**复制一份数据，并将数据帧标记为“**已接收**”。
	- - 数据帧回到源节点后，如果发现异常状况，就尝试**重发**；若无异常，就将令牌传递下一个节点。
- **令牌帧**与**数据帧**在发送数据时转换![[../../CN_Picture/Pasted image 20251205001911.png]]
#### 3.4.4.3 其他补充
- 无论是令牌帧还是数据帧，都只能沿单向传递。  
- 获得令牌的节点，每次只能发一帧，发完就释放令牌。  
- 需要用专门的网络设备（MAU）实现**集中控制**。  
- 令牌传递协议适用于**负载高**的网络（不会发生冲突，效率高）。
### [[../../CN_Contents/第三章 数据链路层|回到目录]]