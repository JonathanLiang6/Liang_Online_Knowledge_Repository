### 5.1.1 内存概述
#### 5.1.1.1 内存墙
**内存墙：** 容量越大，速度越慢（memory 的速度远慢于 CPU）
由此成为了性能的瓶颈
为克服内存墙，弥合 CPU 与内存之间差距的关键在于计算机程序的一个基本属性，即**局部性原理**：任何时候，程序只访问内存空间的一小部分 
**时间局部性**（相同地址） 
最近访问的数据，很可能在不久的将来被再次访问 
`e.g 循环内部的指令和索引变量` 
**空间局部性**（附近地址） 
最近访问的数据旁边的数据，很可能在不久的将来被访问 
`e.g 顺序的指令访问、数组元素`
#### 5.1.1.2 局部性
```c
// 局部性举例
int sum = 0;
for (i = 0; i < n; I++)
	sum += a[i];
return sum;
```
空间局部性：array, structure, object, streaming data
数据相关的构造:表量类型: char, int ,float, double
指令访问中的局部性:指令相关构造: 循环, 分支、顺序
**利用局部性**：内存层次
磁盘存放所有数据 
将**最近访问**（及相邻）的数据，从磁盘拷贝到更小、更快的**DRAM**内存（Main memory） 
将**更加最近访问**（及相邻）的数据，从 DRAM 内存拷贝到更小、更快的 SRAM 内存 
	SRAM 内存，通常指附属在 CPU 的缓存
#### 5.1.1.3 内存层次
![[../../Picture/Pasted image 20241210152429.png]]
**块(aka 行)**: 拷贝的单位，可能包括多个字 
如果要访问的数据在更高的层次:
	**命中**：更高的层次能够满足这次访问  $命中率=\frac{命中次数}{访问次数}$  
如果要访问的数据没在更高的层次:
	**未命中**: 从更低层次拷贝一块到该层次 
	需要更多时间: 未命中的惩罚   未命中率: 未命中次数/访问次数 = 1–命中率 
然后，可以从更高层次访问该数据
### 5.1.2 内存技术
理想的内存：访问速度快，存储容量大，单位价格合理
	![[../../Picture/Pasted image 20241210152647.png]]
#### 5.1.2.1 SRAM
**每个 bit 需 6-8 个逻辑门：贵、快，容量小**
1. **SRAM 特性**：
   - SRAM 是一种简单的集成电路，具有存储阵列结构。
   - 通常配备一个读写端口。
   - 对于任意位置的数据，SRAM 提供固定的访问时间。
2. **无需刷新**：
   - SRAM 不需要刷新电路，这使得其访问时间可以非常接近存储访问的周期时间。
3. **稳定性**：
   - 为了防止读操作时信息丢失，SRAM 每比特使用 6 个或 8 个晶体管。
4. **功耗**：
   - 在待机模式下，SRAM 仅需要最小的功率来维持电荷。
#### 5.1.2.2 DRAM
用电容上的电荷来存储 0/1 需要一个晶体管来访问电容：便宜、慢，但容量大
用电容上的电荷表示数据，使用单个晶体管来访问电荷 
必须周期性地**刷新**：
**刷新**：读取内容然后写回去 
以 DRAM“行”为单位进行刷新
以下是对先进 DRAM（动态随机存取存储器）组成的整理和简化：
##### DRAM 的基本组成和访问模式
1. **位组织**：DRAM 中的位被组织成一个矩形数组。
2. **按行访问**：DRAM 内部以行为单位进行访问。
3. **突发模式**：从一个行中连续供应多个字，以提升吞吐量。
- 突发模式不仅用于 DRAM，也可能用于缓存和磁盘，以提高数据传输效率。
4. 数据速率技术
	**DDR DRAM**：双倍数据速率，数据在时钟的上升和下降边沿都进行传送。
	**QDR DRAM**：四倍数据速率，DDR 的输入和输出独立进行。
##### 影响 DRAM 性能的因素
1. **行缓冲区（Row Buffer）**：允许并行地读和刷新多个字，提高访问速度。
2. **同步 DRAM（SDRAM）**
	使用与 CPU 不一样的时钟。
	**突发访问**：发送一次地址后，允许以突发模式连续访问相邻的地址，提升带宽。
3. **DRAM Banking**：允许同时访问多个 DRAM 模块，进一步提升吞吐量。
#### 5.1.2.3 磁盘存储
**磁盘存储**：非易失, 旋转的磁存储
每个扇区记录了： 
	扇区的 ID 
	数据 (512 字节, 建议使用 4096 字节) 
	纠错码 (ECC)：用来隐藏缺陷和记录错误 
	扇区间的同步字段和间隙 
访问一个扇区的时间包括： 
	排队延迟（如果其他访问正在等待） 
	寻道: 移动磁头到正确的柱面上 
	旋转时间：旋转磁盘，以便磁头定位到正确的扇区 
	数据传输时间 
	控制器开销
磁盘访问举例 ![[../../Picture/Pasted image 20241210155947.png]]
**磁盘性能**：
制造商标注的**平均寻道时间**基于所有可能的寻道方式，通过局部性和 OS 调度，可以实现更短的实际平均寻道时间 
磁盘通常包括**缓存**：支持预取一些扇区，以便后续访问；避免了寻道和旋转时间
#### 5.1.2.4 Flash 存储
Flash 存储：非易失的半导体存储 
比磁盘快 100 倍 – 1000 倍；更小、更低功耗、更稳定可靠 
但是单价更贵（介于磁盘与 DRAM 之间） 
Flash 包括：SSD，SD 卡，SIM 卡，BIOS 系统，U 盘
Flash 的类型：
	**NOR flash**: bit cell like a NOR gate 支持随机读写，用于嵌入式系统中的指令内存
	**NAND flash**: bit cell like a NAND gate 存储密度更高，但是每次访问以块为单位单价更低，用于 U 盘, media storage, …
Flash 单元在 1000 次访问之后，会损坏不适合用直接替换主存，也不适合直接替换磁盘磨损均衡：将数据重新映射到更少使用的物理块
### [[../../Contents/第五章 多层次存储|回到目录]]