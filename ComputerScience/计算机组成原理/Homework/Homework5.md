## 5.2
5.2.1

| Word Address | Binary Address | Tag | Index | Hit/Miss |
|--------------|----------------|-----|-------|----------|
| 0x03         | 0000 0011      | 0   | 3     | M        |
| 0xb4         | 1011 0100      | b   | 4     | M        |
| 0x2b         | 0010 1011      | 2   | b     | M        |
| 0x02         | 0000 0010      | 0   | 2     | M        |
| 0xbf         | 1011 1111      | b   | f     | M        |
| 0x58         | 0101 1000      | 5   | 8     | M        |
| 0xbe         | 1011 1110      | b   | e     | M        |
| 0x0e         | 0000 1110      | 0   | e     | M        |
| 0xb5         | 1011 0101      | b   | 5     | M        |
| 0x2c         | 0010 1100      | 2   | c     | M        |
| 0xba         | 1011 1010      | b   | a     | M        |
| 0xfd         | 1111 1101      | f   | d     | M        |

5.2.2

| Word Address | Binary Address | Tag | Index | Offset | Hit/Miss |
|--------------|----------------|-----|-------|--------|----------|
| 0x03         | 0000 0011      | 0   | 1     | 1      | M        |
| 0xb4         | 1011 0100      | b   | 2     | 0      | M        |
| 0x2b         | 0010 1011      | 2   | 5     | 1      | M        |
| 0x02         | 0000 0010      | 0   | 1     | 0      | H        |
| 0xbf         | 1011 1111      | b   | 7     | 1      | M        |
| 0x58         | 0101 1000      | 5   | 4     | 0      | M        |
| 0xbe         | 1011 1110      | b   | 7     | 0      | H        |
| 0x0e         | 0000 1110      | 0   | 7     | 0      | M        |
| 0xb5         | 1011 0101      | b   | 2     | 1      | H        |
| 0x2c         | 0010 1100      | 2   | 6     | 0      | M        |
| 0xba         | 1011 1010      | b   | 5     | 0      | M        |
| 0xfd         | 1111 1101      | f   | 6     | 1      | M        |

5.2.3

| Word Address | Binary Address | Tag  | Cache 1 Index | Cache 1 Hit/miss | Cache 2 Index | Cache 2 Hit/miss | Cache 3 Index | Cache 3 Hit/miss |     |
| ------------ | -------------- | ---- | ------------- | ---------------- | ------------- | ---------------- | ------------- | ---------------- | --- |
| 0x03         | 0000 0011      | 0x00 | 3             | M                | 1             | M                | 0             | M                |     |
| 0xb4         | 1011 0100      | 0x16 | 4             | M                | 2             | M                | 1             | M                |     |
| 0x2b         | 0010 1011      | 0x05 | 3             | M                | 1             | M                | 0             | M                |     |
| 0x02         | 0000 0010      | 0x00 | 2             | M                | 1             | M                | 0             | M                |     |
| 0xbf         | 1011 1111      | 0x17 | 7             | M                | 3             | M                | 1             | M                |     |
| 0x58         | 0101 1000      | 0x0b | 0             | M                | 0             | M                | 0             | M                |     |
| 0xbe         | 1011 1110      | 0x17 | 6             | M                | 3             | H                | 1             | H                |     |
| 0x0e         | 0000 1110      | 0x01 | 6             | M                | 3             | M                | 1             | M                |     |
| 0xb5         | 1011 0101      | 0x16 | 5             | M                | 2             | H                | 1             | M                |     |
| 0x2c         | 0010 1100      | 0x05 | 4             | M                | 2             | M                | 1             | M                |     |
| 0xba         | 1011 1010      | 0x17 | 2             | M                | 1             | M                | 0             | M                |     |
| 0xfd         | 1111 1101      | 0x1F | 5             | M                | 2             | M                | 1             | M                |     |

Cache 1 丢失率=100%
Cache 1 总周期=12x25+12x2=324 
Cache 2 丢失率=10/12=83%
Cache 2 总周期=10x25+12x3=286 
Cache 3 丢失率=11/12=92%
Cache 3 总周期=11x25+12x5=335
Cache 2 提供最佳性能。

## 5.3
**5.3.1**
总大小为 364544 位=45568 字节
每个字是 8 个字节; 每个块包含两个字节; 因此，每个块包含 $16=2^4$个字节。
缓存包含 $32KiB=2^{15}$ 字节的数据。因此，它有 $2^{15}/2^4=2^{11}$ 行数据。
每个 64 位地址分为: 
(1) 3 位字偏移，(2) 1 位块偏移，(3) 11 位索引 (因为有 $2^11$ 行)，以及 (4) 49 位标签 (64-3-1-11=49)
缓存由: $2^{15}*8$ 位数据+ $2^{11}*49$ 位标签+ $2^{11}*1$ 位有效位=364544 位组成。
**5.3.2**
549376位=68672字节，增加了51%。 
每个字是8个字节;每个块包含16个字节，因此，每个块包含 $128=2^7$ 个字节: 缓存包含 $64KiB =2^{16}$ 字节的数据。因此，它有 $2^{16/}2^7=2^9$ 行数据。
每个64位地址分为:(1)3位字偏移，(2)4位块偏移，(3)9位索引(因为有$2^9$行)，以及(4)48位标签(64-3-4-9=48) 缓存由$:2^{16}*8$位数据+$2^9*48$位标签+$2^9*1$位有效位=549376位组成。
**5.3.3**：较大的块大小可能会导致命中时间增加和未命中惩罚增加。块数量减少可能会导致比原始缓存更高的冲突未命中率。
**5.3.4**：关联缓存旨在减少冲突未命中率。对于具有相同12位索引字段但不同标签字段的连续读取请求，会生成许多未命中。例如，对于上述描述的缓存，序列0、32768、0、32768、0、32768...将在每次访问时都产生未命中。而具有LRU替换的两向集关联缓存，即使总体容量显著较小，也会在访问前两次命中。

## 5.5
5.5.1 每个缓存块由四个 8 字节的字组成。总偏移量为 5 位。这 5 位中的 3 位是字偏移量 (进入 8 字节字中的偏移量)。剩余的 2 位是块偏移量。2 位允许我们枚举 2^2=4 个字。
5.5.2 有五个索引位，这说明缓存中有 $2^5=32$ 行。
5.5.3 比例为 1.21。缓存总共存储 32 行\*4 字节/块\*8 字节/字=1024 字节=8192 位。
除了数据外，每行还包含 54 个标签位和 1 个有效位。因此，所需的总位数=8192+54\*32+1\*32=9952 位。
5.5.4

| Byte Address | Binary Address | Tag | Index | Offset | Hit/Miss | Bytes Replaced |
| ------------ | -------------- | --- | ----- | ------ | -------- | -------------- |
| 0x00         | 0000000000000  | 0x0 | 0x00  | 0x00   | M        |                |
| 0x04         | 0000000001000  | 0x0 | 0x00  | 0x04   | H        |                |
| 0x10         | 0000000100000  | 0x0 | 0x00  | 0x10   | H        |                |
| 0x84         | 0000100001000  | 0x0 | 0x04  | 0x04   | M        |                |
| 0xe8         | 0000111010000  | 0x0 | 0x07  | 0x08   | M        |                |
| 0xa0         | 0000101010000  | 0x0 | 0x05  | 0x00   | M        |                |
| 0x400        | 0100000000000  | 0x1 | 0x00  | 0x00   | M        | 0x00-0x1F      |
| 0x1e         | 0000000111011  | 0x0 | 0x00  | 0x1e   | M        | 0x400-0x41F    |
| 0x8c         | 0000100011100  | 0x0 | 0x04  | 0x0c   | H        |                |
| 0xc1c        | 1100000111100  | 0x3 | 0x00  | 0x1c   | M        | 0x00-0x1F      |
| 0xb4         | 0000101101100  | 0x0 | 0x05  | 0x14   | H        |                |
| 0x884        | 100010000100   | 0x2 | 0x04  | 0x04   | M        | 0x80-0x9f      |

5.5.5 4/12=33%
5.5.6 <index, tag, data> 
<0, 3, Mem[0xC00]-Mem[0xC1F]> 
<4, 2, Mem[0x880]-Mem[0x89f]> 
<5, 0, Mem[0x0A0]-Mem[0x0Bf]> 
<7, 0, Mem[0x0e0]-Mem[0x0ff]>
## 5.10
**5.10.1**

| P1   | 频率      |
|------|-----------|
| P1   | 1.515 GHz |
| P2   | 1.11 GHz  |

 **5.10.2**

| P1   | 访问时间  | 周期数  |
|------|-----------|---------|
| P1   | 6.31 ns   | 9.56    |
| P2   | 5.11 ns   | 5.68    |

对于 P1，所有内存访问至少需要一个周期（访问 L1）。8%的内存访问额外需要 70 纳秒访问主内存。这是 70/0.66=106.06 周期。然而，我们不能分割周期，因此我们必须向上取整到 107 周期。因此，平均内存访问时间是 $( 1 + 0.08 \times 107 = 9.56 ) $周期，或 6.31 皮秒。

对于 P2，主内存访问需要 70 纳秒。这是 70/0.90=77.78 周期。因为我们不能分割周期，我们必须向上取整到 78 周期。因此平均内存访问时间是 $( 1 + 0.06 \times 78 = 5.68 ) $周期，或 6.11 皮秒。

 **5.10.3**

| P1   | CPI  | 每条指令所需时间 |
|------|------|------------------|
| P1   | 12.64| 8.34 纳秒         |
| P2   | 7.36 | 6.63 纳秒         |

对于 P1，每条指令至少需要一个周期。此外，8%的所有指令在指令缓存中未命中，并且会产生 107 周期的延迟。此外，36%的指令是数据访问。这些 36%中的 8%是缓存未命中，这会额外增加 107 周期。

$( 1 + 0.08 \times 107 + 0.36 \times 0.08 \times 107 = 12.64 )$

在 0.66 皮秒的时钟周期下，每条指令需要 8.34 纳秒。

使用相同的逻辑，我们可以看到 P2 的 CPI 为 7.36，平均每条指令只需要 6.63 纳秒。

**5.10.4**
平均内存访问时间（AMAT）= 9.85 周期,更差
L2访问需要九个周期（5.62/0.66向上取整到下一个整数）。

所有内存访问至少需要一个周期。8%的内存访问在L1缓存中未命中，并进行L2访问，这需要九个周期。所有L2访问中有95%是未命中，需要107周期的内存查找。

$[ 1 + 0.08[9 + 0.95 \times 107] = 9.85 ]$

**5.10.5**

3.04

**5.10.6**

因为两个版本的P1的时钟周期时间和内存指令的百分比是相同的，所以只需关注AMAT。我们希望

带有L2的AMAT < 只有L1的AMAT \[ 1 + 0.08[9 + m \times 107] < 9.56 \]

这在 m < 0.916 时发生。

**5.10.7**

我们希望P1的每条指令的平均时间少于6.63纳秒。这意味着我们希望

(CPI_P1 * 0.66) < 6.63。因此，我们需要 CPI_P1 < 10.05

CPI_P1 = AMAT_P1 + 0.36(AMAT_P1 - 1)

因此，我们希望

AMAT_P1 + 0.36(AMAT_P1 - 1) < 10.05

这在 AMAT_P1 < 7.65 时发生。

最后，我们解以下方程

$\[ 1 + 0.08[9 + m \times 107] < 7.65 \]$

并发现 m < 0.693

这个未命中率最多可以是69.3%。

## 5.11

**5.11.1**

Cache中的每行将共有6个字(三种方式各2个)，总共将有48/6=8行。

**5.11.2**

| Word Address | Binary Address | Tag  | Index | Offset | Hit/Miss | Way 0                              | Way 1         | Way 2  |
| ------------ | -------------- | ---- | ----- | ------ | -------- | ---------------------------------- | ------------- | ------ |
| 0x03         | 0000 0011      | 0x0  | 1     | 1      | M        | T(1)=0                             |               |        |
| 0xb4         | 1011 0100      | 0xb  | 2     | 0      | M        | T(1)=0 T(2)=b                      |               |        |
| 0x2b         | 0010 1011      | 0x2  | 5     | 1      | M        | T(1)=0 T(2)=b T(5)=2               |               |        |
| 0x02         | 0000 0010      | 0x0  | 1     | 0      | H        | T(1)=0 T(2)=b T(5)=2               |               |        |
| 0xbe         | 1011 1110      | 0xb  | 7     | 0      | M        | T(1)=0 T(2)=b T(5)=2 T(7)=b        |               |        |
| 0x58         | 0101 1000      | 0x5  | 4     | 0      | M        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 |               |        |
| 0xbf         | 1011 1111      | 0xb  | 7     | 1      | H        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 |               |        |
| 0x0e         | 0000 1110      | 0x0  | 7     | 0      | M        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 | T(7)=0        |        |
| 0x1f         | 0001 1111      | 0x1  | 7     | 1      | M        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 | T(7)=0        | T(7)=1 |
| 0xb5         | 1011 0101      | 0xb  | 2     | 1      | H        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 | T(7)=0        | T(7)=1 |
| 0xbf         | 1011 1111      | 0xb  | 7     | 1      | H        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 | T(7)=0        | T(7)=1 |
| 0xba         | 1011 1010      | 0xb  | 5     | 0      | M        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 | T(7)=2 T(5)=b | T(7)=1 |
| 0x2e         | 0010 1110      | 0x2  | 7     | 0      | M        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 | T(7)=2 T(5)=b | T(7)=1 |
| 0xce         | 1100 1110      | 0xc  | 7     | 0      | M        | T(1)=0 T(2)=b T(5)=2 T(7)=b T(4)=5 | T(7)=2 T(5)=b | T(7)=c |

5.11.4 因为该缓存是全相联的，并且有单字块，所以没有索引和偏移。因此，字地址等同于标签。

| 字地址 | 二进制地址 | 标签 | 命中/未命中 | 内容                          |
| ------ | ---------- | ---- | ----------- | ----------------------------- |
| 0x03   | 0000 0011  | 0x03 | 未命中      | 3                             |
| 0xb4   | 1011 0100  | 0xb4 | 未命中      | 3, b4                         |
| 0x2b   | 0010 1011  | 0x2b | 未命中      | 3, b4, 2b                     |
| 0x02   | 0000 0010  | 0x02 | 未命中      | 3, b4, 2b, 2                  |
| 0xbe   | 1011 1110  | 0xbe | 未命中      | 3, b4, 2b, 2, be              |
| 0x58   | 0101 1000  | 0x58 | 未命中      | 3, b4, 2b, 2, be, 58          |
| 0xbf   | 1011 1111  | 0xbf | 未命中      | 3, b4, 2b, 2, be, 58, bf      |
| 0x0e   | 0000 1110  | 0x0e | 未命中      | 3, b4, 2b, 2, be, 58, bf, e   |
| 0x1f   | 0001 1111  | 0x1f | 未命中      | b4, 2b, 2, be, 58, bf, e, 1f  |
| 0xb5   | 1011 0101  | 0xb5 | 未命中      | 2b, 2, be, 58, bf, e, 1f, b5  |
| 0xbf   | 1011 1111  | 0xbf | 命中        | 2b, 2, be, 58, e, 1f, b5, bf  |
| 0xba   | 1011 1010  | 0xba | 未命中      | 2, be, 58, e, 1f, b5, bf, ba  |
| 0x2e   | 0010 1110  | 0x2e | 未命中      | be, 58, e, 1f, b5, bf, ba, 2e |
| 0xce   | 1100 1110  | 0xce | 未命中      | 58, e, 1f, b5, bf, ba, 2e, ce |

5.11.6 因为该缓存是全相联的，所以没有索引。（内容按照数据被访问的顺序显示。顺序并不意味着物理位置。）

| 字地址 | 二进制地址 | 标签 | 偏移 | 命中/未命中 | 内容                            |
| ------ | ---------- | ---- | ---- | ----------- | ------------------------------- |
| 0x03   | 0000 0011  | 0x01 | 1    | 未命中      | [2,3]                           |
| 0xb4   | 1011 0100  | 0x5a | 0    | 未命中      | [2,3],[b4,b5]                   |
| 0x2b   | 0010 1011  | 0x15 | 1    | 未命中      | [2,3],[b4,b5],[2a,2b]           |
| 0x02   | 0000 0010  | 0x01 | 0    | 命中        | [b4,b5],[2a,2b],[2,3]           |
| 0xbe   | 1011 1110  | 0x5f | 0    | 未命中      | [b4,b5],[2a,2b],[2,3],[be,bf]   |
| 0x58   | 0101 1000  | 0x2c | 0    | 未命中      | [2a,2b],[2,3],[be,bf],[58,59]   |
| 0xbf   | 1011 1111  | 0x5f | 1    | 命中        | [2a,2b],[2,3],[58,59],[be,bf]   |
| 0x0e   | 0000 1110  | 0x07 | 0    | 未命中      | [2,3],[58,59],[be,bf],[e,f]     |
| 0x1f   | 0001 1111  | 0x0f | 1    | 未命中      | [58,59],[be,bf],[e,f],[1e,1f]   |
| 0xb5   | 1011 0101  | 0x5a | 1    | 未命中      | [be,bf],[e,f],[1e,1f],[b4,b5]   |
| 0xbf   | 1011 1111  | 0x5f | 1    | 命中        | [e,f],[1e,1f],[b4,b5],[be,bf]   |
| 0xba   | 1011 1010  | 0x5d | 0    | 未命中      | [1e,1f],[b4,b5],[be,bf],[ba,bb] |
| 0x2e   | 0010 1110  | 0x17 | 0    | 未命中      | [b4,b5],[be,bf],[ba,bb],[2e,2f] |
| 0xce   | 1100 1110  | 0x67 | 0    | 未命中      | [be,bf],[ba,bb],[2e,2f],[ce,cf] |

5.11.7 （内容按照数据被访问的顺序显示。顺序并不意味着物理位置。）

| 字地址 | 二进制地址 | 标签 | 偏移 | 命中/未命中 | 内容                          |
| ------ | ---------- | ---- | ---- | ----------- | ----------------------------- |
| 0x03   | 0000 0011  | 0x01 | 1    | 未命中      | [2,3]                         |
| 0xb4   | 1011 0100  | 0x5a | 0    | 未命中      | [2,3],[b4,b5]                 |
| 0x2b   | 0010 1011  | 0x15 | 1    | 未命中      | [2,3],[b4,b5],[2a,2b]         |
| 0x02   | 0000 0010  | 0x01 | 0    | 命中        | [b4,b5],[2a,2b],[2,3]         |
| 0xbe   | 1011 1110  | 0x5f | 0    | 未命中      | [b4,b5],[2a,2b],[2,3],[be,bf] |
| 0x58   | 0101 1000  | 0x2c | 0    | 未命中      | [b4,b5],[2a,2b],[2,3],[58,59] |
| 0xbf   | 1011 1111  | 0x5f | 1    | 未命中      | [b4,b5],[2a,2b],[2,3],[be,bf] |
| 0x0e   | 0000 1110  | 0x07 | 0    | 未命中      | [b4,b5],[2a,2b],[2,3],[e,f]   |
| 0x1f   | 0001 1111  | 0x0f | 1    | 未命中      | [b4,b5],[2a,2b],[2,3],[1e,1f] |
| 0xb5   | 1011 0101  | 0x5a | 1    | 命中        | [2a,2b],[2,3],[1e,1f],[b4,b5] |
| 0xbf   | 1011 1111  | 0x5f | 1    | 未命中      | [2a,2b],[2,3],[1e,1f],[be,bf] |
| 0xba   | 1011 1010  | 0x5d | 0    | 未命中      | [2a,2b],[2,3],[1e,1f],[ba,bb] |
| 0x2e   | 0010 1110  | 0x17 | 0    | 未命中      | [2a,2b],[2,3],[1e,1f],[2e,2f] |
| 0xce   | 1100 1110  | 0x67 | 0    | 未命中      | [2a,2b],[2,3],[1e,1f],[ce,cf] |

5.11.8 因为该缓存是全相联的，所以没有索引。

| 字地址 | 二进制地址 | 标签 | 偏移 | 命中/未命中 | 内容                            |
| ------ | ---------- | ---- | ---- | ----------- | ------------------------------- |
| 0x03   | 0000 0011  | 0x01 | 1    | 未命中      | [2,3]                           |
| 0xb4   | 1011 0100  | 0x5a | 0    | 未命中      | [2,3],[b4,b5]                   |
| 0x2b   | 0010 1011  | 0x15 | 1    | 未命中      | [2,3],[b4,b5],[2a,2b]           |
| 0x02   | 0000 0010  | 0x01 | 0    | 命中        | [2,3],[b4,b5],[2a,2b]           |
| 0xbe   | 1011 1110  | 0x5f | 0    | 未命中      | [2,3],[b4,b5],[2a,2b],[be,bf]   |
| 0x58   | 0101 1000  | 0x2c | 0    | 未命中      | [58,59],[b4,b5],[2a,2b],[be,bf] |
| 0xbf   | 1011 1111  | 0x5f | 1    | 命中        | [58,59],[b4,b5],[2a,2b],[be,bf] |
| 0x0e   | 0000 1110  | 0x07 | 0    | 未命中      | [e,f],[b4,b5],[2a,2b],[be,bf]   |
| 0x1f   | 0001 1111  | 0x0f | 1    | 未命中      | [1e,1f],[b4,b5],[2a,2b],[be,bf] |
| 0xb5   | 1011 0101  | 0x5a | 1    | 命中        | [1e,1f],[b4,b5],[2a,2b],[be,bf] |
| 0xbf   | 1011 1111  | 0x5f | 1    | 命中        | [1e,1f],[b4,b5],[2a,2b],[be,bf] |
| 0xba   | 1011 1010  | 0x5d | 0    | 未命中      | [1e,1f],[b4,b5],[ba,bb],[be,bf] |
| 0x2e   | 0010 1110  | 0x17 | 0    | 未命中      | [1e,1f],[b4,b5],[2e,2f],[be,bf] |
| 0xce   | 1100 1110  | 0x67 | 0    | 未命中      | [1e,1f],[b4,b5],[ce,cf],[be,bf] |

## 5.16

### 5.16.1

| 地址         | 虚拟页 | TLB 命中/未命中       | 有效位        | 标签 | 物理页 |
| ------------ | ------ | --------------------- | ------------- | ---- | ------ |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中 PF | 1             | b    | 12     |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中 PF | 1             | 7    | 4      |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中 PF | 1             | 3    | 6      |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中 PF | 1(最后访问 0) | 1    | 13     |
| 2227 0x08b3  | 0      | TLB 未命中 PT 命中    | 1(最后访问 1) | 0    | 5      |
| 2227 0x08b3  | 0      | TLB 未命中 PT 命中    | 1             | 7    | 4      |
| 2227 0x08b3  | 0      | TLB 未命中 PT 命中    | 1             | 3    | 6      |
| 2227 0x08b3  | 0      | TLB 未命中 PT 命中    | 1(最后访问 0) | 1    | 13     |
| 13916 0x365c | 3      | TLB 未命中 PT 命中    | 1(最后访问 1) | 0    | 5      |
| 13916 0x365c | 3      | TLB 未命中 PT 命中    | 1             | 7    | 4      |
| 13916 0x365c | 3      | TLB 未命中 PT 命中    | 1(最后访问 2) | 3    | 6      |
| 13916 0x365c | 3      | TLB 未命中 PT 命中    | 1(最后访问 0) | 1    | 13     |
| 34587 0x871b | 8      | TLB 未命中 PT 命中 PF | 1(最后访问 1) | 0    | 5      |
| 34587 0x871b | 8      | TLB 未命中 PT 命中 PF | 1(最后访问 3) | 8    | 14     |
| 34587 0x871b | 8      | TLB 未命中 PT 命中 PF | 1(最后访问 2) | 3    | 6      |
| 34587 0x871b | 8      | TLB 未命中 PT 命中 PF | 1(最后访问 0) | 1    | 13     |
| 48870 0xbee6 | b      | TLB 未命中 PT 命中    | 1(最后访问 1) | 0    | 5      |
| 48870 0xbee6 | b      | TLB 未命中 PT 命中    | 1(最后访问 3) | 8    | 14     |
| 48870 0xbee6 | b      | TLB 未命中 PT 命中    | 1(最后访问 2) | 3    | 6      |
| 48870 0xbee6 | b      | TLB 未命中 PT 命中    | 1(最后访问 4) | b    | 12     |
| 12608 0x3140 | 3      | TLB 命中 PT 命中      | 1(最后访问 1) | 0    | 5      |
| 12608 0x3140 | 3      | TLB 命中 PT 命中      | 1(最后访问 3) | 8    | 14     |
| 12608 0x3140 | 3      | TLB 命中 PT 命中      | 1(最后访问 5) | 3    | 6      |
| 12608 0x3140 | 3      | TLB 命中 PT 命中      | 1(最后访问 4) | b    | 12     |
| 49225 0xc040 | C      | TLB 未命中 PT 命中 PF | 1(最后访问 6) | C    | 15     |
| 49225 0xc040 | C      | TLB 未命中 PT 命中 PF | 1(最后访问 3) | 8    | 14     |
| 49225 0xc040 | C      | TLB 未命中 PT 命中 PF | 1(最后访问 5) | 3    | 6      |
| 49225 0xc040 | C      | TLB 未命中 PT 命中 PF | 1(最后访问 4) | b    | 12     |

### 5.16.2

| 地址         | 虚拟页 | TLB 命中/未命中       | 有效位        | 标签 | 物理页 |
| ------------ | ------ | --------------------- | ------------- | ---- | ------ |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中    | 1             | 11   | 12     |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中    | 1             | 7    | 4      |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中    | 1             | 3    | 6      |
| 4669 0x123d  | 1      | TLB 未命中 PT 命中    | 1(最后访问 0) | 0    | 5      |
| 2227 0x08b3  | 0      | TLB 命中              | 1             | 11   | 12     |
| 2227 0x08b3  | 0      | TLB 命中              | 1             | 7    | 4      |
| 2227 0x08b3  | 0      | TLB 命中              | 1             | 3    | 6      |
| 2227 0x08b3  | 0      | TLB 命中              | 1(最后访问 1) | 0    | 5      |
| 13916 0x365c | 0      | TLB 命中 PT 命中      | 1             | 11   | 12     |
| 13916 0x365c | 0      | TLB 命中 PT 命中      | 1             | 7    | 4      |
| 13916 0x365c | 0      | TLB 命中 PT 命中      | 1             | 3    | 6      |
| 13916 0x365c | 0      | TLB 命中 PT 命中      | 1(最后访问 2) | 0    | 5      |
| 34587 0x871b | 2      | TLB 未命中 PT 命中 PF | 1(最后访问 3) | 2    | 13     |
| 34587 0x871b | 2      | TLB 未命中 PT 命中 PF | 1             | 7    | 4      |
| 34587 0x871b | 2      | TLB 未命中 PT 命中 PF | 1             | 3    | 6      |
| 34587 0x871b | 2      | TLB 未命中 PT 命中 PF | 2             | 0    | 5      |
| 48870 0xbee6 | 2      | TLB 命中 PT 命中      | 1(最后访问 4) | 2    | 13     |
| 48870 0xbee6 | 2      | TLB 命中 PT 命中      | 1             | 7    | 4      |
| 48870 0xbee6 | 2      | TLB 命中 PT 命中      | 1             | 3    | 6      |
| 48870 0xbee6 | 2      | TLB 命中 PT 命中      | 1(最后访问 2) | 0    | 5      |
| 12608 0x3140 | 0      | TLB 命中 PT 命中      | 1(最后访问 4) | 2    | 13     |
| 12608 0x3140 | 0      | TLB 命中 PT 命中      | 1             | 7    | 4      |
| 12608 0x3140 | 0      | TLB 命中 PT 命中      | 1             | 3    | 6      |
| 12608 0x3140 | 0      | TLB 命中 PT 命中      | 5             | 0    | 5      |
| 49225 0xc040 | 3      | TLB 命中 PT 命中      | 1(最后访问 4) | 2    | 13     |
| 49225 0xc040 | 3      | TLB 命中 PT 命中      | 1             | 7    | 4      |
| 49225 0xc040 | 3      | TLB 命中 PT 命中      | 1(最后访问 6) | 3    | 6      |
| 49225 0xc040 | 3 | TLB 命中 PT 命中 | 1(最后访问 5) | 0 | 5 |

### 5.16.3 两路组相联

| 地址 | 虚拟页 | 标签 | 索引 | TLB 命中/未命中 | 有效位 | 标签 | 物理页 | 索引 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 1 | b | 12 | 0 |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 1 | 7 | 7 | 1 |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 1 | 3 | 6 | 0 |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 1(最后访问 0) | 0 | 13 | 1 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 1(最后访问 1) | 0 | 5 | 0 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 1 | 7 | 4 | 1 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 1 | 3 | 6 | 0 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 1(最后访问 0) | 0 | 13 | 1 |
| 13916 0x365c | 3 | 1 | 1 | TLB 未命中 PT 命中 | 1(最后访问 1) | 0 | 5 | 0 |
| 13916 0x365c | 3 | 1 | 1 | TLB 未命中 PT 命中 | 1(最后访问 2) | 1 | 6 | 1 |
| 13916 0x365c | 3 | 1 | 1 | TLB 未命中 PT 命中 | 1 | 3 | 6 | 0 |
| 13916 0x365c | 3 | 1 | 1 | TLB 未命中 PT 命中 | 1(最后访问 0) | 1 | 13 | 1 |
| 34587 0x871b | 8 | 4 | 0 | TLB 未命中 PT 命中 PF | 1(最后访问 1) | 0 | 5 | 0 |
| 34587 0x871b | 8 | 4 | 0 | TLB 未命中 PT 命中 PF | 1(最后访问 2) | 1 | 6 | 1 |
| 34587 0x871b | 8 | 4 | 0 | TLB 未命中 PT 命中 PF | 1(最后访问 3) | 4 | 14 | 0 |
| 34587 0x871b | 8 | 4 | 0 | TLB 未命中 PT 命中 PF | 1(最后访问 0) | 1 | 13 | 1 |
| 48870 0xbee6 | b | 5 | 1 | TLB 未命中 PT 命中 | 1(最后访问 1) | 0 | 5 | 0 |
| 48870 0xbee6 | b | 5 | 1 | TLB 未命中 PT 命中 | 1(最后访问 2) | 1 | 6 | 1 |
| 48870 0xbee6 | b | 5 | 1 | TLB 未命中 PT 命中 | 1(最后访问 3) | 4 | 14 | 0 |
| 48870 0xbee6 | b | 5 | 1 | TLB 未命中 PT 命中 | 1(最后访问 4) | 5 | 12 | 1 |
| 12608 0x3140 | 3 | 1 | 1 | TLB 命中 PT 命中 | 1(最后访问 1) | 0 | 5 | 0 |
| 12608 0x3140 | 3 | 1 | 1 | TLB 命中 PT 命中 | 1(最后访问 5) | 1 | 6 | 1 |
| 12608 0x3140 | 3 | 1 | 1 | TLB 命中 PT 命中 | 1(最后访问 3) | 4 | 14 | 0 |
| 12608 0x3140 | 3 | 1 | 1 | TLB 命中 PT 命中 | 1(最后访问 4) | 5 | 12 | 1 |
| 49225 0xc049 | C | 6 | 0 | TLB 未命中 PT 未命中 PF | 1(最后访问 6) | 6 | 15 | 0 |
| 49225 0xc049 | C | 6 | 0 | TLB 未命中 PT 未命中 PF | 1(最后访问 5) | 1 | 6 | 1 |
| 49225 0xc049 | C | 6 | 0 | TLB 未命中 PT 未命中 PF | 1(最后访问 3) | 4 | 14 | 0 |
| 49225 0xc049 | C | 6 | 0 | TLB 未命中 PT 未命中 PF | 1(最后访问 4) | 5 | 12 | 1 |

### 5.16.4 直接映射

| 地址 | 虚拟页 | 标签 | 索引 | TLB 命中/未命中 | 有效位 | 标签 | 物理页 | 索引 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 1 | b | 12 | 0 |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 1 | 0 | 13 | 1 |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 1 | 3 | 6 | 2 |
| 4669 0x123d | 1 | 0 | 1 | TLB 未命中 PT 命中 PF | 0 | 4 | 9 | 3 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 1 | 0 | 5 | 0 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 1 | 0 | 13 | 1 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 1 | 3 | 6 | 2 |
| 2227 0x08b3 | 0 | 0 | 0 | TLB 未命中 PT 命中 | 0 | 4 | 9 | 3 |
| 13916 0x365c | 3 | 0 | 3 | TLB 未命中 PT 命中 | 1 | 0 | 5 | 0 |
| 13916 0x365c | 3 | 0 | 3 | TLB 未命中 PT 命中 | 1 | 0 | 13 | 1 |
| 13916 0x365c | 3 | 0 | 3 | TLB 未命中 PT 命中 | 1 | 3 | 6 | 2 |
| 13916 0x365c | 3 | 0 | 3 | TLB 未命中 PT 命中 | 1 | 0 | 6 | 3 |
| 34587 0x871b | 8 | 2 | 0 | TLB 未命中 PT 命中 PF | 1 | 2 | 14 | 0 |
| 34587 0x871b | 8 | 2 | 0 | TLB 未命中 PT 命中 PF | 1 | 0 | 13 | 1 |
| 34587 0x871b | 8 | 2 | 0 | TLB 未命中 PT 命中 PF | 1 | 3 | 6 | 2 |
| 34587 0x871b | 8 | 2 | 0 | TLB 未命中 PT 命中 PF | 1 | 0 | 6 | 3 |
| 48870 0xbee6 | b | 2 | 3 | TLB 未命中 PT 命中 | 1 | 2 | 14 | 0 |
| 48870 0xbee6 | b | 2 | 3 | TLB 未命中 PT 命中 | 1 | 0 | 13 | 1 |
| 48870 0xbee6 | b | 2 | 3 | TLB 未命中 PT 命中 | 1 | 3 | 6 | 2 |
| 48870 0xbee6 | b | 2 | 3 | TLB 未命中 PT 命中 | 1 | 2 | 12 | 3 |
| 12608 0x3140 | 3 | 0 | 3 | TLB 命中 PT 命中 | 1 | 2 | 14 | 0 |
| 12608 0x3140 | 3 | 0 | 3 | TLB 命中 PT 命中 | 1 | 0 | 13 | 1 |
| 12608 0x3140 | 3 | 0 | 3 | TLB 命中 PT 命中 | 1 | 3 | 6 | 2 |
| 12608 0x3140 | 3 | 0 | 3 | TLB 命中 PT 命中 | 1 | 0 | 6 | 3 |
| 49225 0xc049 | C | 3 | 0 | TLB 未命中 PT 未命中 PF | 1 | 3 | 15 | 0 |
| 49225 0xc049 | C | 3 | 0 | TLB 未命中 PT 未命中 PF | 1 | 0 | 13 | 1 |
| 49225 0xc049 | C | 3 | 0 | TLB 未命中 PT 未命中 PF | 1 | 3 | 6 | 2 |
| 49225 0xc049 | C | 3 | 0 | TLB 未命中 PT 未命中 PF | 1 | 0 | 6 | 3 |

### 5.16.5

如果没有 TLB，几乎每次内存访问都需要两次访问 RAM：一次访问页表，然后访问请求的数据。



## 5.18

5.18.1 最坏的情况是2^(43-12)^=2^31^条目，需要2^(31)^x4字节=2^33^=8GB。
5.18.2 在只有两个层次的情况下，设计者可以选择每个页面表段的大小。在多层次方案中，读取一个PTE需要访问表的每个层次。
5.18.3 是的，如果段表条目被假定为段页的物理页码，并且保留一个位作为有效位，那么每个段表条目的有效访问量为(231)*4KiB=8TiB，这足以覆盖机器的物理地址空间(16GiB)。
5.18.4 每个页面表级别包含4KiB/4B=1024条目，因此翻译log2(1024)=10位的虚拟地址。使用43位的虚拟地址和4KiB的页面，我们需要ceil((43-12)/10)=4个翻译级别。
5.18.5 在倒置的页表结构中，PTE的数量可以减少到哈希表的大小加上冲突的成本。在这种情况下，处理TLB未命中需要额外的引用来比较存储在哈希表中的标签或标签。