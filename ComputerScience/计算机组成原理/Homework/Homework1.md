# 计算机组成与设计第一次作业

## 1.6

> 有3种不同的处理器P1、P2、P3执行同样的指令集，P1的时钟频率为3GHz，CPI为1.5；P2的时钟频率为2.5GHz，CPI为1.0；P3的时钟频率为4GHz，CPI为2.2。
>
> a、以每秒执行的指令数为标准，哪个处理器性能最高？
>
> b、如果每个处理器执行一个程序都要花费10s时间，求它们的时钟周期数和指令数。
>
> c、我们试图把执行时间减少30%，但这会引起CPI增加20%。请问为达到时间减少30%的目标，时钟频率应达到多少？

### a：应用公式为：指令数=$\frac{时钟周期数}{CPI}$=$\frac{时钟频率×时间}{CPI}$

- P1：$\frac{3GHz}{1.5}$=2×10^9^
- P2: $\frac{2.5GHz}{1.0}$=2.5×10^9^
- P3: $\frac{4GHz}{2.2}$≈1.82×10^9^

**结论：P2处理器性能最高**

### b：应用公式为：指令数=$\frac{时钟周期数}{CPI}$；时钟周期数=时钟频率×时间

| 处理器 | 时钟周期数              | 指令数                                 |
| ------ | ----------------------- | -------------------------------------- |
| P1     | 10s×3Ghz = 3×10^10^     | $\frac{3×10^{10}}{1.5}$ = 2×10^10^     |
| P2     | 10s×2.5Ghz = 2.5×10^10^ | $\frac{2.5×10^{10}}{1.0}$ = 2.5×10^10^ |
| P3     | 10s×4Ghz = 4×10^10^     | $\frac{4×10^{10}}{2.2}$ = 1.82×10^10^  |

### c:应用公式：时钟频率=$\frac{指令数×CPI}{执行时间}$

新执行时间=10s×（1-30%）=7s

新CPI=原CPI×（1+20%），得

P1：1.8  P2：1.2  P3：2.64

$时钟频率_{P1}$=$\frac{2×10^{10}×1.8}{7}$≈5.143Ghz

$时钟频率_{P2}$=$\frac{2.5×10^{10}×1.2}{7}$≈4.286Ghz

$时钟频率_{P3}$=$\frac{1.82×10^{10}×2.64}{7}$≈6.474Ghz

## 1.7

> 同一个指令集体系结构有两种不同的实现方式。根据CPI的不同将指令分成4类（A、B、C和D），P1的时钟频率为2.5GHz，CPI分别为1、2、3和3；P2的时钟频率为3GHz，CPI分别为2、2、2和2。给定一个程序，有1.0×10^6^条动态指令，按如下比例分为4类：A：10%，B：20%，C：50%，D：20%。
>
> a、每种实现方式下的整体CPI是多少？
>
> b、计算两种情况下的时钟周期总数

### a：核心为：各类指令的加权平均

先计算各类指令的指令数：指令数=总指令数×比例

$A：1.0×10^6×10%=1.0×10^5$

$ 
$B：1.0×10^6×20\%=2.0×10^5$
$C：1.0×10^6×50%=5.0×10^5$

$ 
$D：1.0×10^6×20\%=2.0×10^5$

$CPI_{P1}$=$\frac{(1.0×10^5×1)+(2.0×10^5×2)+(5.0×10^5×3)+(2.0×10^5×3)}{1.0×10^6}$=2.6

$CPI_{P2}$=$\frac{(1.0×10^5×2)+(2.0×10^5×2)+(5.0×10^5×2)+(2.0×10^5×2)}{1.0×10^6}$=2.0

### b：应用公式：时钟周期总数=CPI×指令总数

$时钟周期总数_{P1}$=$CPI_{P1}$×指令总数$=2.6×1×10^6=2.6×10^6$

$时钟周期总数_{P2}$=$CPI_{P2}$×指令总数$=2.0×1×10^6=2.0×10^6$

## 1.10

> 1.10 在一个处理器中，假定算术指令、load/store指令和分支指令的CPI分别是1、12和5。同时假定某程序在单个处理器核上运行时需要执行2.56×10^9^条算术指令、1.28×10^9^条load/store指令和2.56×10^8^条分支指令，并假定处理器的时钟频率为2GHz。
>
> 现假设程序并行运行在多核上，分配到每个处理器核上运行的算术指令和load/store指令数目为单核情况下相应指令条数除以0.7×p（p是处理器核数），而每个处理器的分支指令数量保持不变。
>
> 1.10.1 求出当该程序分别运行在1、2、4、和8个处理器核上的执行时间，并求出其他情况下相对于单核处理器的加速比。
>
> 1.10.2 如果算术指令的CPI加倍，对分别运行在1、2、4和8个处理器核上的执行时间有何影响？
>
> 1.10.3 如果要使单核处理器的性能与四核处理器相当，单处理器中load/store指令的CPI应降低多少？此处假定四核处理器的CPI保持原数值不变。

### 1.10.1应用公式：CPU时间 = $\frac{指令数×CPI}{时钟频率}$

#### 单核情况：

执行时间=$\frac{2.56\times10^9\times1+1.28\times10^9\times12+2.56\times10^8\times5}{2GHz}$=9.6s

#### 2核情况：

$\sum CPI\times指令数=\frac{2.56\times10^9\times1}{0.7\times2}+\frac{1.28\times10^9\times12}{0.7\times2}+2.56\times10^8\times5$=14.08×10^9^

执行时间=$\frac{14.08×10^9}{2GHz}$=7.04s

加速比=$\frac{T_1}{T_2}$=$\frac{9.6}{7.04}$=1.36

#### 4核情况：

$\sum CPI\times指令数=\frac{2.56\times10^9\times1}{0.7\times4}+\frac{1.28\times10^9\times12}{0.7\times4}+2.56\times10^8\times5$=7.68×10^9^

执行时间=$\frac{7.68×10^9}{2GHz}$=3.84s

加速比=$\frac{T_1}{T_2}$=$\frac{9.6}{3.84}$=2.50

#### 8核情况：

$\sum CPI\times指令数=\frac{2.56\times10^9\times1}{0.7\times8}+\frac{1.28\times10^9\times12}{0.7\times8}+2.56\times10^8\times5$=4.48×10^9^

执行时间=$\frac{3.52×10^9}{2GHz}$=2.24s

加速比=$\frac{T_1}{T_2}$=$\frac{9.6}{2.24}$=4.29

### 1.10.2 将算术指令CPI由1改为2代入上述式子计算

#### 单核情况：

新执行时间=$\frac{2.56\times10^9\times2+1.28\times10^9\times12+2.56\times10^8\times5}{2GHz}$=10.88s

#### 2核情况：

$\sum CPI\times指令数=\frac{2.56\times10^9\times2}{0.7\times2}+\frac{1.28\times10^9\times12}{0.7\times2}+2.56\times10^8\times5$=15.91×10^9^

新执行时间=$\frac{15.91×10^9}{2GHz}$=7.95s

#### 4核情况：

$\sum CPI\times指令数=\frac{2.56\times10^9\times2}{0.7\times4}+\frac{1.28\times10^9\times12}{0.7\times4}+2.56\times10^8\times5$=8.59×10^9^

执行时间=$\frac{8.59×10^9}{2GHz}$=4.30s

#### 3核情况：

$\sum CPI\times指令数=\frac{2.56\times10^9\times2}{0.7\times8}+\frac{1.28\times10^9\times12}{0.7\times8}+2.56\times10^8\times5$=4.94×10^9^

新执行时间=$\frac{4.94×10^9}{2GHz}$=2.47s

### 1.10.3 以执行时间为性能度量因素进行分析

$执行时间_{单核}=执行时间_{四核}$

$\frac{2.56\times10^9\times1+1.28\times10^9\times NewCPI+2.56\times10^8\times5}{2GHz}=\frac{\frac{2.56\times10^9\times2}{0.7\times4}+\frac{1.28\times10^9\times12}{0.7\times4}+2.56\times10^8\times5}{2GHz}$

解得：NewCPI=3，即原CPI应降低9

## 1.12

> 1.12 SPEC CPU2006的bzip2基准程序在AMD Barcelona处理器上执行的总指令数为2.389×10^12^，执行时间为750s，参考时间为9650s。
>
> 1.12.1 如果时钟周期时间为0.333ns，求CPI值。
>
> 1.12.2 求SPEC的分值。
>
> 1.12.3 如果基准程序的指令数增加10%，CPI不变，求CPU时间增加多少？
>
> 1.12.4 如果基准程序的指令数增加10%，CPI增加5%，求CPU时间增加多少？
>
> 1.12.5 根据上题中指令数和CPI的变化，求SPEC分值的变化。
>
> 1.12.6 假设开发了一款新的AMD Barcelona处理器，其工作频率为4GHz，在其指令系统中增加了一些新的指令，从而使程序中的指令数目减少了15%，程序的执行时间减少到了700s，新的SPEC分值为13.7，求新的CPI。
>
> 1.12.7 当时钟频率由3GHz上升到4GHz时，上一小题算出的CPI比1.12.1的高。请确定CPI的升高是否与频率升高相同？如果不同，为什么？
>
> 1.12.8 CPU时间减少了多少？
>
> 1.12.9 对第二个基准程序libquantum，假定执行时间为960ns，CPI为1.61，时钟频率为3GHz。在时钟频率为4GHz时，在不影响CPI的前提下执行时间降低10%，求指令数。
>
> 1.12.10 在指令数和CPI保持不变的前提下，如果要将CPU时间进一步减少10%，求时钟频率。
>
> 1.12.11 在指令数保持不变的前提下，如果要将CPI降低15%，CPU时间减少20%，求时钟频率。

### 1.12.1 CPI = $\frac{执行时间\times时钟频率}{指令数}$

CPI=$\frac{750\times3\times10^{9}}{2.389\times10^{12}}$=0.942

### 1.12.2 SPEC分值=$\frac{参考处理器执行时间}{被测计算机执行时间}$

SPEC分值=$\frac{9650}{750}$=12.87

### 1.12.3 CPU时间=指令数×CPI×时钟周期时间

新CPU时间=$2.389\times10^{12}\times(1+10\%)\times1.06\times0.333\times10^{-9}=927.59s$

增加CPU时间=927.59-750=177.59s

### 1.12.4 公式同上

新CPU时间=$2.389\times10^{12}\times(1+10\%)\times1.06\times(1+5\%)\times0.333\times10^{-9}=973.98s$

增加CPU时间=973.98-750=223.98s

### 1.12.5 类似1.12.2

新SPEC分值=$\frac{9650}{973.98}$=9.91

### 1.12.6 CPI = $\frac{执行时间\times时钟频率}{指令数}$

新CPI=$\frac{700\times4\times10^{9}}{2.389\times10^{12}\times(1-15\%)}$=1.38

### 1.12.7

CPI的变化与频率的变化是两个不同的概念，CPI表示的是每条指令的平均时钟周期数，而频率上升意味着每秒执行的周期数增加。在新的处理器中，尽管频率提高了，但CPI的变化与频率无直接关系，可能由于其他因素影响，如指令优化和资源竞争。

### 1.12.8 CPU时间=指令数×CPI×时钟周期时间

$新CPU时间=2.389\times10^{12}\times(1-15\%)\times1.38\times\frac{1}{4GHz}=700.57s$

减少时间=750-700.57=49.43s

### 1.12.9 

新执行时间=960 s×0.9=864 s

时钟周期时间=$\frac{1}{4 GHz}$=0.25 ns

指令数=$\frac{CPU时间}{CPI×时钟周期时间}$

$指令数=\frac{864s}{1.61×(0.25×10^{−9 }s)}=2.14×10^{12}$

### 1.12.10 进一步减少10% CPU时间，求时钟频率

当前执行时间为864秒，减少10%为：

新执行时间=864 s×0.9=777.6 s

在CPI仍为1.61的情况下，所需时钟频率为：

时钟频率=$\frac{指令数×CPI}{新执行时间}$

时钟频率=$\frac{2.14×10^{12}×1.61}{777.6 s}$=4.43GHz

### 1.12.11 重新计算时钟频率

新CPU时间=960s×0.8=768s

新CPI=1.61×0.85≈1.3685

时钟频率=$\frac{指令数×新CPI}{新CPU时间}=\frac{2.14×10^{12}×1.3685}{768}$=3.81GHz

